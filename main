---
- name: "Vérifier la connectivité au partage FSx"
  win_stat:
    path: "\\\\{{ fsx_ip }}\\{{ fsx_share }}"
  register: fsx_share_check
  tags: [check_fsx]

- name: "Échec si le partage FSx n'est pas accessible"
  fail:
    msg: "Impossible d'accéder au partage FSx : \\\\{{ fsx_ip }}\\{{ fsx_share }}"
  when: not fsx_share_check.stat.exists
  tags: [check_fsx]

- name: "Créer le dossier {{ target_folder }} sur le partage FSx"
  win_file:
    path: "\\\\{{ fsx_ip }}\\{{ fsx_share }}\\{{ target_folder }}"
    state: directory
  register: folder_creation
  tags: [create_folder]

- name: "Vérifier que le dossier a été créé"
  win_stat:
    path: "\\\\{{ fsx_ip }}\\{{ fsx_share }}\\{{ target_folder }}"
  register: folder_check
  tags: [verify_folder]

- name: "Échec de création du dossier"
  fail:
    msg: "Échec de création du dossier {{ target_folder }}"
  when: not folder_check.stat.exists
  tags: [verify_folder]
