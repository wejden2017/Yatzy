---
- name: "Créer le groupe RW (lecture/écriture)"
  win_domain_group:
    name: "{{ users_data.groups.rw_group }}"
    scope: global
    category: security
    state: present
    organizational_unit: "{{ users_data.organizational_unit }}"
  register: rw_group_creation
  tags: [create_groups]

- name: "Créer le groupe RO (lecture seule)"
  win_domain_group:
    name: "{{ users_data.groups.ro_group }}"
    scope: global
    category: security
    state: present
    organizational_unit: "{{ users_data.organizational_unit }}"
  register: ro_group_creation
  tags: [create_groups]

- name: "Vérifier la création du groupe RW"
  win_domain_group:
    name: "{{ users_data.groups.rw_group }}"
    state: present
  register: rw_group_check
  tags: [verify_groups]

- name: "Vérifier la création du groupe RO"
  win_domain_group:
    name: "{{ users_data.groups.ro_group }}"
    state: present
  register: ro_group_check
  tags: [verify_groups]

- name: "Échec si les groupes n'ont pas été créés"
  fail:
    msg: "Échec de création des groupes AD"
  when: rw_group_check is failed or ro_group_check is failed
  tags: [verify_groups]
