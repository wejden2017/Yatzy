- name: Create DDL trigger for all schemas
  shell: |
    set -eo pipefail
    {{ _ora_sqlplus }} <<'SQL'
    WHENEVER OSERROR EXIT 1
    WHENEVER SQLERROR EXIT SQL.SQLCODE
    SET SERVEROUTPUT ON SIZE UNLIMITED
    SET HEADING OFF FEEDBACK OFF PAGES 0 VERIFY OFF ECHO OFF TERMOUT ON
    SPOOL /tmp/create_trigger_all_schemas.log
    @/tmp/auto_grant_trigger_all_schemas.sql
    SPOOL OFF
    EXIT
    SQL
  args:
    executable: /bin/bash
  environment:
    ORACLE_HOME: "{{ oracle_home }}"
    LD_LIBRARY_PATH: "{{ oracle_home }}/lib"
    PATH: "{{ oracle_home }}/bin:{{ ansible_env.PATH | default('') }}"
  register: create_triggers
  changed_when: create_triggers.rc == 0
  failed_when: create_triggers.rc != 0
  tags: [setup, triggers]
