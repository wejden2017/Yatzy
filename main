# Correction pour Windows AD servers
ad_instances = get_ec2_instances('Role', 'ACTIVE-DIRECTORY', region)
for instance in ad_instances:
    inventory['windows_ad_servers']['hosts'].append(instance['private_ip'])
    inventory['_meta']['hostvars'][instance['private_ip']] = {
        'ansible_user': 'Administrator',  # ← Utilisateur Windows par défaut
        'ansible_password': '{{ windows_admin_password }}',  # ← À définir dans vault
        'ansible_connection': 'winrm',    # ← Connexion WinRM pour Windows
        'ansible_winrm_transport': 'ntlm', # ← Authentification NTLM
        'ansible_winrm_server_cert_validation': 'ignore',  # ← Pour certificats auto-signés
        'ansible_port': 5986,             # ← Port WinRM HTTPS (ou 5985 HTTP)
        # Optionnel : pour forcer PowerShell
        'ansible_shell_type': 'powershell'
    }
