Script orchestrateur : /cats/oper/exe/traitement_CALYPSO_integration_csv.ksh

#!/bin/ksh
# ============================================================================
# Script : traitement_CALYPSO_integration_csv.ksh
# Objet  : V√©rifie la pr√©sence des fichiers CAL_TO_CAT_*.CSV et appelle
#          le script d'int√©gration pour chaque fichier trouv√©.
# ============================================================================

DATA_DIR="/cats/oper/data/apf"
SCRIPT_SHARED="/cats/oper/exe/SharedApps/CALYPSO_integration_csv.ksh"
LOG_FILE="/cats/oper/logs/traitement_CALYPSO_integration_csv.log"

# Cr√©ation du r√©pertoire de logs si inexistant
mkdir -p $(dirname $LOG_FILE)

echo "=== D√©but traitement $(date '+%Y-%m-%d %H:%M:%S') ===" >> $LOG_FILE

# Recherche des fichiers CSV
FILES=$(ls ${DATA_DIR}/CAL_TO_CAT_*.CSV 2>/dev/null)

if [ -z "$FILES" ]; then
    echo "$(date '+%Y-%m-%d %H:%M:%S') - Aucun fichier trouv√© dans $DATA_DIR" >> $LOG_FILE
    exit 0
fi

# Boucle sur chaque fichier
for file in $FILES
do
    echo "$(date '+%Y-%m-%d %H:%M:%S') - D√©tection fichier : $file" >> $LOG_FILE
    $SCRIPT_SHARED "$file" >> $LOG_FILE 2>&1
done

echo "=== Fin traitement $(date '+%Y-%m-%d %H:%M:%S') ===" >> $LOG_FILE
exit 0


---

2Ô∏è‚É£ Script d‚Äôint√©gration : /cats/oper/exe/SharedApps/CALYPSO_integration_csv.ksh

#!/bin/ksh
# ============================================================================
# Script : CALYPSO_integration_csv.ksh
# Objet  : Traite un fichier CSV CALYPSO pass√© en param√®tre et le renomme
#          en <fichier>_traite si succ√®s, ou <fichier>_error si √©chec.
# ============================================================================

file="$1"

if [ -z "$file" ]; then
    echo "Usage: $0 <fichier>"
    exit 1
fi

echo "[$(date '+%Y-%m-%d %H:%M:%S')] - D√©but traitement du fichier : $file"

# >>> Ici tu mets la vraie logique de traitement m√©tier <<<
# Pour l'exemple on simule un traitement OK :
RET=0

if [ $RET -eq 0 ]; then
    mv "$file" "${file}_traite"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] - Succ√®s : $file renomm√© en ${file}_traite"
    exit 0
else
    mv "$file" "${file}_error"
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] - Erreur : $file renomm√© en ${file}_error"
    exit 1
fi


---

üîé R√©sum√© :

Tu ex√©cutes seulement traitement_CALYPSO_integration_csv.ksh ‚Üí il cherche les fichiers et appelle le script SharedApps pour chacun.

Le script SharedApps traite et renomme le fichier.

Les logs d√©taill√©s vont dans /cats/oper/logs/traitement_CALYPSO_integration_csv.log.
