---
- name: "Configurer Security Descriptor et permissions NTFS pour Administrator"
  hosts: localhost
  gather_facts: no

  tasks:
    - name: "Appliquer les permissions NetApp NTFS en ssh"
      shell: |
        sshpass -p "n703DkkuCz711WCA" ssh -o StrictHostKeyChecking=no fsxadmin@10.105.57.117 '
          vserver security file-directory ntfs create -vserver cats-svm -ntfs-sd ADMIN_SD || true
          vserver security file-directory ntfs dacl add -vserver cats-svm -ntfs-sd ADMIN_SD -access-type allow -account cats\\Administrator -rights full-control || true
          vserver security file-directory apply -vserver cats-svm -path /FSHQ -ntfs-sd ADMIN_SD
        '
      register: create_sd_result
      ignore_errors: yes
      tags: [netapp_perms]

    - name: "Afficher la sortie compl√®te du shell"
      debug:
        var: create_sd_result

    - name: "Afficher uniquement la sortie stdout"
      debug:
        msg: "{{ create_sd_result.stdout_lines }}"
