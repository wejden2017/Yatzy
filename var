-- =====================================================
-- Création du rôle DEV_ROLE
-- =====================================================

SET SERVEROUTPUT ON SIZE UNLIMITED
SET FEEDBACK OFF
SET VERIFY OFF
SET ECHO OFF
WHENEVER SQLERROR CONTINUE

-- Étape 1: Créer le rôle s'il n'existe pas
DECLARE
    v_count NUMBER;
BEGIN
    SELECT COUNT(*) INTO v_count
    FROM dba_roles
    WHERE role = 'DEV_ROLE';
    
    IF v_count = 0 THEN
        EXECUTE IMMEDIATE 'CREATE ROLE DEV_ROLE';
        DBMS_OUTPUT.PUT_LINE('[CREATE] Role DEV_ROLE created');
    ELSE
        DBMS_OUTPUT.PUT_LINE('[EXISTS] Role DEV_ROLE already exists');
    END IF;
END;
/

WHENEVER SQLERROR CONTINUE

DBMS_OUTPUT.PUT_LINE('[GRANTS] Applying privileges to DEV_ROLE...');

GRANT CREATE SESSION TO DEV_ROLE;
GRANT CONNECT TO DEV_ROLE;
GRANT RESOURCE TO DEV_ROLE;
GRANT CREATE TABLE TO DEV_ROLE;
GRANT CREATE VIEW TO DEV_ROLE;
GRANT CREATE PROCEDURE TO DEV_ROLE;
GRANT CREATE SEQUENCE TO DEV_ROLE;
GRANT CREATE SYNONYM TO DEV_ROLE;
GRANT CREATE TRIGGER TO DEV_ROLE;
GRANT CREATE TYPE TO DEV_ROLE;
GRANT CREATE MATERIALIZED VIEW TO DEV_ROLE;
GRANT CREATE DATABASE LINK TO DEV_ROLE;
GRANT SELECT_CATALOG_ROLE TO DEV_ROLE;
GRANT SELECT ANY DICTIONARY TO DEV_ROLE;
GRANT ANALYZE ANY TO DEV_ROLE;

GRANT SELECT ON V_$SESSION TO DEV_ROLE;
GRANT SELECT ON V_$SQL TO DEV_ROLE;
GRANT SELECT ON V_$SQL_PLAN TO DEV_ROLE;
GRANT SELECT ON V_$SQLAREA TO DEV_ROLE;
GRANT SELECT ON V_$PARAMETER TO DEV_ROLE;

DBMS_OUTPUT.PUT_LINE('[SUCCESS] All privileges applied to DEV_ROLE');

COMMIT;

