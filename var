# 1. Arrêter le conteneur
docker stop ibm-mq

# 2. Renommer le fichier d'autoconfiguration pour le désactiver
sudo mv /mnt/mqdata/data/qmgrs/QM1/autocfg/cached.mqsc /mnt/mqdata/data/qmgrs/QM1/autocfg/cached.mqsc.disabled

# 3. Créer notre propre fichier de config qui sera appliqué au démarrage
sudo tee /mnt/mqdata/data/qmgrs/QM1/autocfg/99-disable-auth.mqsc << 'EOF'
* Disable all authentication
ALTER CHANNEL(DEV.APP.SVRCONN) CHLTYPE(SVRCONN) MCAUSER('mqm')
ALTER QMGR CHLAUTH(DISABLED)
ALTER QMGR CONNAUTH('')
REFRESH SECURITY TYPE(CONNAUTH)
SET CHLAUTH('*') TYPE(BLOCKUSER) USERLIST('nobody') ACTION(REPLACE)
REFRESH SECURITY(*)
EOF

# 4. Redémarrer le conteneur
docker start ibm-mq

# Attendre 30 secondes
sleep 30

# Vérifier la config
docker exec ibm-mq runmqsc QM1 << EOF
DISPLAY QMGR CHLAUTH CONNAUTH
DISPLAY CHANNEL(DEV.APP.SVRCONN)
END
EOF

# Voir ce qu'il y a dans cached.mqsc (c'est probablement là le problème)
sudo cat /mnt/mqdata/data/qmgrs/QM1/autocfg/cached.mqsc

docker stop ibm-mq

# 2. Sauvegarder qm.ini
sudo cp /mnt/mqdata/data/qmgrs/QM1/qm.ini /mnt/mqdata/data/qmgrs/QM1/qm.ini.backup

# 3. Modifier qm.ini
sudo nano /mnt/mqdata/data/qmgrs/QM1/qm.ini
```

Dans le fichier, **modifiez ou ajoutez ces lignes** :

Dans la section `Channels:`, changez :
```
ChlauthEarlyAdopt=No
```

Et **ajoutez** cette section si elle n'existe pas :
```
Security:
   MQIBindType=STANDARD

# 1. Vérifier le fichier qm.ini (configuration principale)
sudo cat /mnt/mqdata/data/qmgrs/QM1/qm.ini

# 2. Chercher des fichiers .mqsc d'initialisation
sudo find /mnt/mqdata -name "*.mqsc" -o -name "*.ini"

# 3. Vérifier s'il y a un dossier de config auto
sudo ls -la /mnt/mqdata/data/qmgrs/QM1/
```

Envoyez-moi les résultats, en particulier le contenu de `qm.ini`.

## Ce qu'on cherche dans qm.ini :

Le fichier `qm.ini` contient probablement quelque chose comme :
```
Service:
   Name=AuthorizationService
   ...
Security:
   ConnAuth=DEV.AUTHINFO

# 1. Vérifier que le conteneur tourne bien
docker ps | grep ibm-mq

# 2. Vérifier la configuration actuelle
docker exec ibm-mq runmqsc QM1 << EOF
DISPLAY QMGR CHLAUTH CONNAUTH
DISPLAY CHANNEL(DEV.APP.SVRCONN)
DISPLAY CHLAUTH(DEV.APP.SVRCONN)
END
EOF


# Arrêter et supprimer
docker stop ibm-mq
docker rm ibm-mq

# Recréer SANS MQ_APP_PASSWORD
docker run -d \
  --name ibm-mq \
  --restart unless-stopped \
  -p 1414:1414 \
  -p 9443:9443 \
  -v /mnt/mqdata:/var/mqm \
  -e LICENSE=accept \
  -e MQ_QMGR_NAME=QM1 \
  -e MQ_ADMIN_PASSWORD=admin \
  -e MQ_DEV=true \
  ibmcom/mq:9.2.4.0-r1-amd64

# Attendre 30 secondes
sleep 30

# Vérifier les logs
docker logs ibm-mq | tail -20
