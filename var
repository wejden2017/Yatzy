---
- name: EC2 Tools Lifecycle
  hosts: tools_servers
  become: true
  vars:
    ansible_python_interpreter: /usr/bin/python3
    do_install_docker: true
    do_install_mq: true

  pre_tasks:
    - name: Ensure SELinux Python bindings are present (via raw yum)
      ansible.builtin.raw: sudo yum install -y libselinux-python
      register: selinux_install
      changed_when: "'Complete!' in selinux_install.stdout or 'Nothing to do' not in selinux_install.stdout"
      become: true

  roles:
    - role: docker_setup
      when: do_install_docker

    - role: ibmmq
      when: do_install_mq and docker_ready | default(false)
