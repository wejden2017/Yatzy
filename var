  tasks:
    - name: "Charger le fichier JSON des utilisateurs"
      include_vars:
        file: "roles/ad/vars/users.json"
        name: users_data

    - name: "ÉTAPE 1 - Créer les groupes AD"
      include_tasks: roles/ad/tasks/create_groups.yml
      tags: [test_groups]

    - name: "ÉTAPE 2 - Configurer permissions NetApp"
      include_tasks: roles/ad/tasks/configure_netapp_permissions.yml
      tags: [netapp_perms]

    - name: "ÉTAPE 3 - Créer le dossier CATS_LINUX"
      include_tasks: roles/ad/tasks/create_folder.yml
      tags: [test_folder]

    - name: "DEBUG FINAL - Test complet"
      debug:
        msg: |
          === Configuration terminée ===
          Groupes AD créés: {{ users_data.groups.rw_group }}, {{ users_data.groups.ro_group }}
          Permissions NetApp configurées pour: /FSHQ/CATS_LINUX
          Dossier créé: \\{{ fsx_ip }}\{{ fsx_share }}\{{ target_folder }}
      tags: [test_folder, test_groups, netapp_perms]
