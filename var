private static Stream<ReconciliationSemt002> map(final SecurityEndOfDayReport report) {

    // Si la liste est vide, on injecte un AccountBalance fictif
    if (report.getAccountBalances() == null || report.getAccountBalances().isEmpty()) {
        log.warn("AccountBalances is empty for report {} - injecting test value", report.getId());

        AccountBalance fakeBalance = new AccountBalance();
        fakeBalance.setMontantValo(BigDecimal.ONE); // Valeur test
      

        report.setAccountBalances(Collections.singletonList(fakeBalance));
    }


    BigDecimal montantTotal = report.getAccountBalances()
        .stream()
        .map(a -> a.getMontantValo() != null ? a.getMontantValo() : BigDecimal.ZERO)
        .reduce(BigDecimal.ZERO, BigDecimal::add);


    return report.getAccountBalances()
        .stream()
        .map(balance -> Semt002Dao.map(report, balance, montantTotal));
}
