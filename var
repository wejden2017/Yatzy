def get_ec2_instances(tag_key, tag_value, region):
    ec2 = boto3.client('ec2', region_name=region)
    response = ec2.describe_instances(
        Filters=[
            {'Name': f'tag:{tag_key}', 'Values': [tag_value]},
            {'Name': 'instance-state-name', 'Values': ['running']}
        ]
    )

    instances = []
    for reservation in response['Reservations']:
        for instance in reservation['Instances']:
            # Récupération du Public DNS depuis les tags si existant
            public_dns_tag = next(
                (tag['Value'] for tag in instance.get('Tags', []) if tag['Key'] == 'PublicDnsName'),
                None
            )

            # Récupération directe du VPC ID
            vpc_id_value = instance.get('VpcId', 'vpc-UNKNOWN')

            instances.append({
                'private_ip': instance.get('PrivateIpAddress', 'N/A'),
                'instance_id': instance.get('InstanceId', 'N/A'),
                'PublicDnsName': public_dns_tag,
                'vpc_id': vpc_id_value
            })
    return instances
