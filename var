@Test
    void map_filters_nulls_and_computes_total() throws Exception {
        SecurityEndOfDayReport report = mock(SecurityEndOfDayReport.class);

        AccountBalance b1 = mock(AccountBalance.class);
        when(b1.getMontantValeur()).thenReturn(new BigDecimal("100"));

        AccountBalance b2 = mock(AccountBalance.class);
        when(b2.getMontantValeur()).thenReturn(null);

        AccountBalance b3 = null;

        when(report.getAccountBalances()).thenReturn(Arrays.asList(b1, b2, b3));

        Method m = Semt002Dao.class.getDeclaredMethod("map", SecurityEndOfDayReport.class);
        m.setAccessible(true);
        Stream<?> stream = (Stream<?>) m.invoke(null, report);

        List<?> list = stream.collect(Collectors.toList());
        assertEquals(1, list.size());

        Object rec = list.get(0);
        Field f = rec.getClass().getDeclaredField("montantTotal");
        f.setAccessible(true);
        BigDecimal total = (BigDecimal) f.get(rec);
        assertEquals(new BigDecimal("100"), total);
    }
