#!/usr/bin/expect -f

# Charger les variables d'environnement (injectées via Ansible ou définies ici par défaut)
set timeout -1
set install_dir [lindex $argv 0]
set tmp_dir [lindex $argv 1]
set file1 [lindex $argv 2]
set file2 [lindex $argv 3]

# Démarrer l'installation en sudo
spawn sudo $tmp_dir/install_vtom $tmp_dir/$file1 $tmp_dir/$file2

expect {
    "?" {
        send "n\r"
        exp_continue
    }
    -re {Nom du serveur de backup.*\[aucun\].*} {
        send "\r"
        exp_continue
    }
    -re {Repertoire de base d'installation.*} {
        send "$install_dir\r"
        exp_continue
    }
    -re {Definissez l'administrateur.*} {
        send "\r"
        exp_continue
    }
    -re {Repertoire de la base de donnees.*} {
        send "\r"
        exp_continue
    }
    -re {Repertoire de backup.*} {
        send "\r"
        exp_continue
    }
    -re {Repertoire des traces.*} {
        send "\r"
        exp_continue
    }
    -re {Repertoire des fichiers logs.*} {
        send "\r"
        exp_continue
    }
    -re {Sauvegarder l'installation existante.*\[n\]} {
        send "o\r"
        exp_continue
    }
    -re {Confirmez-vous ces parametres.*\[o\]} {
        send "o\r"
        exp_continue
    }
    -re {Numero de port tcp pour tomDBd.*\[aucun\]} {
        send "30001\r"
        exp_continue
    }
    -re {Numero de port tcp pour vtmanager.*\[aucun\]} {
        send "30000\r"
        exp_continue
    }
    eof
}
