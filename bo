- name: Copy updated MQSC file to temporary location in container
  ansible.builtin.command: >
    docker cp /opt/ibmmq/config/config.mqsc {{ ibmmq_container_name }}:/tmp/config.mqsc.new
  when:
    - mq_exist.stdout != ""
    - mqsc_template_updated.changed
  changed_when: true

- name: Overwrite mounted MQSC file using cat redirect
  ansible.builtin.command: >
    docker exec {{ ibmmq_container_name }}
    bash -c "cat /tmp/config.mqsc.new > /etc/mqm/99-custom.mqsc && rm /tmp/config.mqsc.new"
  when:
    - mq_exist.stdout != ""
    - mqsc_template_updated.changed
  changed_when: true

- name: Set correct permissions in container
  ansible.builtin.command: >
    docker exec {{ ibmmq_container_name }}
    chown 1001:0 /etc/mqm/99-custom.mqsc
  when:
    - mq_exist.stdout != ""
    - mqsc_template_updated.changed
  changed_when: false
